# üìß Formato de Emails - CSN Minera√ß√£o

## Padr√µes Identificados

Os emails de solicita√ß√£o de t√°xi da CSN Minera√ß√£o seguem estes formatos:

### **Formato 1: Email Simples com Tabela**

```
Assunto: PROGRAMA√á√ÉO DE TAXI amanh√£ 16:00H

Prezados, boa Noite!

Gentileza programar um TAXI amanh√£ 06/09/2025 16:00H

CSN DESTINHO BH

CC:20086

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ EDIMAR JULIO FERREIRA SOARES‚îÇ MIN7956‚îÇ (31)988873751‚îÇ CSN  ‚îÇ MARIANA ‚îÇ
‚îÇ FERNANDO ANGELO GONCALVES   ‚îÇ MIN7956‚îÇ (31)984840900‚îÇ      ‚îÇ         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Extra√ß√£o esperada:**
- Nome: "EDIMAR JULIO FERREIRA SOARES, FERNANDO ANGELO GONCALVES"
- Telefone: "31988873751"
- Origem: "CSN Minera√ß√£o, Congonhas, MG"
- Destino: "Mariana, MG"
- Hor√°rio: 2025-09-06T16:00:00-03:00
- Notes: "CC:20086, 2 passageiros: EDIMAR (MIN7956), FERNANDO (MIN7956)"

---

### **Formato 2: Email com Destino Especificado**

```
Assunto: PROGRAMA√á√ÉO DE TAXI amanh√£ 15:30h

Prezados, boa Noite!

Gentileza programar um TAXI amanh√£ 06/09/2025 15:30h

CSN DESTINHO BH

CC:20063

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Harlle Jonathan da Rocha   ‚îÇ MIP 0060‚îÇ 37998742019 ‚îÇ CSN  ‚îÇ  BH  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Extra√ß√£o esperada:**
- Nome: "Harlle Jonathan da Rocha"
- Telefone: "37998742019"
- Origem: "CSN Minera√ß√£o, Congonhas, MG"
- Destino: "Belo Horizonte, MG"
- Hor√°rio: 2025-09-06T15:30:00-03:00
- Notes: "CC:20063, Matr√≠cula: MIP 0060"

---

### **Formato 3: Email com Endere√ßo Completo**

```
Assunto: PROGRAMA√á√ÉO DE TAXI hoje 04:30h

Prezados, bom dia!

Gentileza programar um TAXI hoje 04:30h

CC:20381

RUA BARRAS, N200 BAIRRO CALAFATE destino CSN

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ MAICON ‚îÇ MIO3554‚îÇ 9 8440-1424/9 9062-6923‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Extra√ß√£o esperada:**
- Nome: "MAICON"
- Telefone: "98440-1424"
- Origem: "Rua Barras, 200, Bairro Calafate, Belo Horizonte, MG"
- Destino: "CSN Minera√ß√£o, Congonhas, MG"
- Hor√°rio: 2025-08-31T04:30:00-03:00 (hoje + hora)
- Notes: "CC:20381, Matr√≠cula: MIO3554, Telefone alternativo: 99062-6923"

---

### **Formato 4: M√∫ltiplos Passageiros com Endere√ßos Detalhados**

```
Assunto: PROGRAMA√á√ÉO DE CARRO HOJE 15:00h

Prezados, boa Tarde!

Gentileza programar CARRO HOJE 15:00 FERNANDINHO 15:00h DESTINO LAFAIETE

CC:20049

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ GRACY ADRIANE COSTA‚îÇMNC0789‚îÇRUA JOSE ALEXANDRE RAMOS, 38   ‚îÇCONSELHEIRO LAFAIETE‚îÇ
‚îÇ AGNALDO FERNANDES  ‚îÇMI05688‚îÇRUA ETELVINA DE LIMA,426, STA M‚îÇCONSELHEIRO LAFAIETE‚îÇ
‚îÇ MARCIANO           ‚îÇMNC0220‚îÇRUA JOAO FERREIRA, 346, S.C. JE‚îÇCONSELHEIRO LAFAIETE‚îÇ
‚îÇ DIEGO              ‚îÇ       ‚îÇRUA ARNALDO SEZARINO 18 FONTE G‚îÇ                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Extra√ß√£o esperada:**
- Nome: "GRACY ADRIANE COSTA, AGNALDO FERNANDES, MARCIANO, DIEGO"
- Telefone: (buscar no contexto ou deixar primeiro encontrado)
- Origem: "Rua Jose Alexandre Ramos, 38, Conselheiro Lafaiete, MG"
- Destino: "Conselheiro Lafaiete, MG"
- Hor√°rio: 2025-08-23T15:00:00-03:00
- Notes: "CC:20049, 4 passageiros com endere√ßos diferentes. GRACY (MNC0789), AGNALDO (MI05688), MARCIANO (MNC0220), DIEGO"

---

### **Formato 5: Ida e Volta**

```
Assunto: PROGRAMA√á√ÉO DE CARRO AMANH√É 23/08/2025

Prezados, boa Noite!

Gentileza programar um T√ÅXI AMANH√É 23/08/2025 04:00H E RETORNO 16:00H

CC:20049

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îê
‚îÇ23/08/2025‚îÇ MIO9580‚îÇ Rua Antonio Barbosa 55     ‚îÇIbirit√© / MG  ‚îÇEstrada Casa de Pedra, S/N   ‚îÇCongonhas‚îÇ04:00 ‚îÇ-‚îÇ
‚îÇ          ‚îÇ        ‚îÇ centro                     ‚îÇ              ‚îÇZona Rural                   ‚îÇ/ MG     ‚îÇ      ‚îÇ ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚î§
‚îÇ23/08/2025‚îÇ MIO9580‚îÇ Estrada Casa de Pedra, S/N ‚îÇCongonhas / MG‚îÇRua Antonio Barbosa 55-centro‚îÇIbirit√© ‚îÇ16:00 ‚îÇ-‚îÇ
‚îÇ          ‚îÇ        ‚îÇ Zona Rural                 ‚îÇ              ‚îÇ                             ‚îÇ/ MG     ‚îÇ      ‚îÇ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îò
```

**Extra√ß√£o esperada:**
- Nome: "Passageiro MIO9580"
- Telefone: (buscar ou inferir)
- Origem: "Rua Antonio Barbosa, 55, Centro, Ibirit√©, MG"
- Destino: "Estrada Casa de Pedra, S/N, Zona Rural, Congonhas, MG"
- Hor√°rio IDA: 2025-08-23T04:00:00-03:00
- Notes: "CC:20049, RETORNO √†s 16:00 de Congonhas para Ibirit√©. Matr√≠cula: MIO9580"

---

## Mapeamento de Locais Comuns

| Sigla/Termo | Endere√ßo Completo | Coordenadas Aproximadas |
|-------------|-------------------|-------------------------|
| CSN | CSN Minera√ß√£o, Congonhas, MG | -20.5033, -43.8569 |
| BH | Belo Horizonte, MG | -19.9191, -43.9387 |
| MARIANA | Mariana, MG | -20.3778, -43.4172 |
| LAFAIETE / CONSELHEIRO LAFAIETE | Conselheiro Lafaiete, MG | -20.6606, -43.7858 |
| CONGONHAS | Congonhas, MG | -20.5033, -43.8569 |
| IBIRIT√â | Ibirit√©, MG | -20.0219, -44.0588 |

---

## Configura√ß√£o do Sistema

### Vari√°vel de Ambiente

```env
EMAIL_SUBJECT_FILTER=PROGRAMA√á√ÉO
```

Isso capturar√°:
- "PROGRAMA√á√ÉO DE TAXI amanh√£ 16:00H"
- "PROGRAMA√á√ÉO DE CARRO HOJE 15:00h"
- "PROGRAMA√á√ÉO DE CARRO AMANH√É 23/08/2025"

### LLM Prompt

O sistema LLM foi configurado para:
1. ‚úÖ Reconhecer siglas e expandi-las
2. ‚úÖ Converter hor√°rios relativos (hoje, amanh√£)
3. ‚úÖ Extrair dados de tabelas e texto livre
4. ‚úÖ Identificar m√∫ltiplos passageiros
5. ‚úÖ Detectar viagens de retorno
6. ‚úÖ Normalizar telefones (remover caracteres especiais)
7. ‚úÖ Adicionar timezone de Bras√≠lia (-03:00)
8. ‚úÖ Fallback por regex: se o LLM omitir destino ou forma de pagamento, tentamos capturar linhas `Destino:` / `Pagamento:` no corpo do email

---

## Testes Recomendados

Para testar o sistema com seus emails reais:

1. **Configure o filtro de assunto**:
   ```env
   EMAIL_SUBJECT_FILTER=PROGRAMA√á√ÉO
   ```

2. **Execute o processador**:
   ```bash
   python run_processor.py
   ```
> ‚ö†Ô∏è **Se desejar evitar geocoding (coordenadas / estimativa de valor)**,
> configure `DISABLE_GEOCODING=true` no `.env` ou nas vari√°veis do Railway.
> O sistema enviar√° apenas os endere√ßos textuais recebidos.
3. **Verifique os logs**:
   ```bash
   tail -f data/taxi_automation.log
   ```

4. **Confira o Dashboard**:
   ```bash
   streamlit run app_liquid.py
   ```

---

## Pr√≥ximos Passos

1. ‚úÖ LLM atualizado para reconhecer formato CSN
2. ‚úÖ Filtro de email ajustado para "PROGRAMA√á√ÉO"
3. ‚è≠Ô∏è Testar com emails reais
4. ‚è≠Ô∏è Ajustar geocoding para locais CSN
5. ‚è≠Ô∏è Validar integra√ß√£o com MinasTaxi API

**O sistema est√° pronto para processar os emails da CSN Minera√ß√£o!** üöÄ

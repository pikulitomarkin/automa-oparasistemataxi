# ğŸ“§ Formato de Emails - CSN MineraÃ§Ã£o

## PadrÃµes Identificados

Os emails de solicitaÃ§Ã£o de tÃ¡xi da CSN MineraÃ§Ã£o seguem estes formatos:

### **Formato 1: Email Simples com Tabela**

```
Assunto: PROGRAMAÃ‡ÃƒO DE TAXI amanhÃ£ 16:00H

Prezados, boa Noite!

Gentileza programar um TAXI amanhÃ£ 06/09/2025 16:00H

CSN DESTINHO BH

CC:20086

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EDIMAR JULIO FERREIRA SOARESâ”‚ MIN7956â”‚ (31)988873751â”‚ CSN  â”‚ MARIANA â”‚
â”‚ FERNANDO ANGELO GONCALVES   â”‚ MIN7956â”‚ (31)984840900â”‚      â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ExtraÃ§Ã£o esperada:**
- Nome: "EDIMAR JULIO FERREIRA SOARES, FERNANDO ANGELO GONCALVES"
- Telefone: "31988873751"
- Origem: "CSN MineraÃ§Ã£o, Congonhas, MG"
- Destino: "Mariana, MG"
- HorÃ¡rio: 2025-09-06T16:00:00-03:00
- Notes: "CC:20086, 2 passageiros: EDIMAR (MIN7956), FERNANDO (MIN7956)"

---

### **Formato 2: Email com Destino Especificado**

```
Assunto: PROGRAMAÃ‡ÃƒO DE TAXI amanhÃ£ 15:30h

Prezados, boa Noite!

Gentileza programar um TAXI amanhÃ£ 06/09/2025 15:30h

CSN DESTINHO BH

CC:20063

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ Harlle Jonathan da Rocha   â”‚ MIP 0060â”‚ 37998742019 â”‚ CSN  â”‚  BH  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

**ExtraÃ§Ã£o esperada:**
- Nome: "Harlle Jonathan da Rocha"
- Telefone: "37998742019"
- Origem: "CSN MineraÃ§Ã£o, Congonhas, MG"
- Destino: "Belo Horizonte, MG"
- HorÃ¡rio: 2025-09-06T15:30:00-03:00
- Notes: "CC:20063, MatrÃ­cula: MIP 0060"

---

### **Formato 3: Email com EndereÃ§o Completo**

```
Assunto: PROGRAMAÃ‡ÃƒO DE TAXI hoje 04:30h

Prezados, bom dia!

Gentileza programar um TAXI hoje 04:30h

CC:20381

RUA BARRAS, N200 BAIRRO CALAFATE destino CSN

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MAICON â”‚ MIO3554â”‚ 9 8440-1424/9 9062-6923â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ExtraÃ§Ã£o esperada:**
- Nome: "MAICON"
- Telefone: "98440-1424"
- Origem: "Rua Barras, 200, Bairro Calafate, Belo Horizonte, MG"
- Destino: "CSN MineraÃ§Ã£o, Congonhas, MG"
- HorÃ¡rio: 2025-08-31T04:30:00-03:00 (hoje + hora)
- Notes: "CC:20381, MatrÃ­cula: MIO3554, Telefone alternativo: 99062-6923"

---

### **Formato 4: MÃºltiplos Passageiros com EndereÃ§os Detalhados**

```
Assunto: PROGRAMAÃ‡ÃƒO DE CARRO HOJE 15:00h

Prezados, boa Tarde!

Gentileza programar CARRO HOJE 15:00 FERNANDINHO 15:00h DESTINO LAFAIETE

CC:20049

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GRACY ADRIANE COSTAâ”‚MNC0789â”‚RUA JOSE ALEXANDRE RAMOS, 38   â”‚CONSELHEIRO LAFAIETEâ”‚
â”‚ AGNALDO FERNANDES  â”‚MI05688â”‚RUA ETELVINA DE LIMA,426, STA Mâ”‚CONSELHEIRO LAFAIETEâ”‚
â”‚ MARCIANO           â”‚MNC0220â”‚RUA JOAO FERREIRA, 346, S.C. JEâ”‚CONSELHEIRO LAFAIETEâ”‚
â”‚ DIEGO              â”‚       â”‚RUA ARNALDO SEZARINO 18 FONTE Gâ”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ExtraÃ§Ã£o esperada:**
- Nome: "GRACY ADRIANE COSTA, AGNALDO FERNANDES, MARCIANO, DIEGO"
- Telefone: (buscar no contexto ou deixar primeiro encontrado)
- Origem: "Rua Jose Alexandre Ramos, 38, Conselheiro Lafaiete, MG"
- Destino: "Conselheiro Lafaiete, MG"
- HorÃ¡rio: 2025-08-23T15:00:00-03:00
- Notes: "CC:20049, 4 passageiros com endereÃ§os diferentes. GRACY (MNC0789), AGNALDO (MI05688), MARCIANO (MNC0220), DIEGO"

---

### **Formato 5: Ida e Volta**

```
Assunto: PROGRAMAÃ‡ÃƒO DE CARRO AMANHÃƒ 23/08/2025

Prezados, boa Noite!

Gentileza programar um TÃXI AMANHÃƒ 23/08/2025 04:00H E RETORNO 16:00H

CC:20049

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”
â”‚23/08/2025â”‚ MIO9580â”‚ Rua Antonio Barbosa 55     â”‚IbiritÃ© / MG  â”‚Estrada Casa de Pedra, S/N   â”‚Congonhasâ”‚04:00 â”‚-â”‚
â”‚          â”‚        â”‚ centro                     â”‚              â”‚Zona Rural                   â”‚/ MG     â”‚      â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”¤
â”‚23/08/2025â”‚ MIO9580â”‚ Estrada Casa de Pedra, S/N â”‚Congonhas / MGâ”‚Rua Antonio Barbosa 55-centroâ”‚IbiritÃ© â”‚16:00 â”‚-â”‚
â”‚          â”‚        â”‚ Zona Rural                 â”‚              â”‚                             â”‚/ MG     â”‚      â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”˜
```

**ExtraÃ§Ã£o esperada:**
- Nome: "Passageiro MIO9580"
- Telefone: (buscar ou inferir)
- Origem: "Rua Antonio Barbosa, 55, Centro, IbiritÃ©, MG"
- Destino: "Estrada Casa de Pedra, S/N, Zona Rural, Congonhas, MG"
- HorÃ¡rio IDA: 2025-08-23T04:00:00-03:00
- Notes: "CC:20049, RETORNO Ã s 16:00 de Congonhas para IbiritÃ©. MatrÃ­cula: MIO9580"

---

## Mapeamento de Locais Comuns

| Sigla/Termo | EndereÃ§o Completo | Coordenadas Aproximadas |
|-------------|-------------------|-------------------------|
| CSN | CSN MineraÃ§Ã£o, Congonhas, MG | -20.5033, -43.8569 |
| BH | Belo Horizonte, MG | -19.9191, -43.9387 |
| MARIANA | Mariana, MG | -20.3778, -43.4172 |
| LAFAIETE / CONSELHEIRO LAFAIETE | Conselheiro Lafaiete, MG | -20.6606, -43.7858 |
| CONGONHAS | Congonhas, MG | -20.5033, -43.8569 |
| IBIRITÃ‰ | IbiritÃ©, MG | -20.0219, -44.0588 |

---

## ConfiguraÃ§Ã£o do Sistema

### VariÃ¡vel de Ambiente

```env
EMAIL_SUBJECT_FILTER=PROGRAMAÃ‡ÃƒO
```

Isso capturarÃ¡:
- "PROGRAMAÃ‡ÃƒO DE TAXI amanhÃ£ 16:00H"
- "PROGRAMAÃ‡ÃƒO DE CARRO HOJE 15:00h"
- "PROGRAMAÃ‡ÃƒO DE CARRO AMANHÃƒ 23/08/2025"

### LLM Prompt

O sistema LLM foi configurado para:
1. âœ… Reconhecer siglas e expandi-las
2. âœ… Converter horÃ¡rios relativos (hoje, amanhÃ£)
3. âœ… Extrair dados de tabelas e texto livre
4. âœ… Identificar mÃºltiplos passageiros
5. âœ… Detectar viagens de retorno
6. âœ… Normalizar telefones (remover caracteres especiais)
7. âœ… Adicionar timezone de BrasÃ­lia (-03:00)
8. âœ… Fallback por regex: se o LLM omitir destino ou forma de pagamento, tentamos capturar linhas `Destino:` / `Pagamento:` no corpo do email

---

## Testes Recomendados

Para testar o sistema com seus emails reais:

1. **Configure o filtro de assunto**:
   ```env
   EMAIL_SUBJECT_FILTER=PROGRAMAÃ‡ÃƒO
   ```

2. **Execute o processador**:
   ```bash
   python run_processor.py
   ```

3. **Verifique os logs**:
   ```bash
   tail -f data/taxi_automation.log
   ```

4. **Confira o Dashboard**:
   ```bash
   streamlit run app_liquid.py
   ```

---

## PrÃ³ximos Passos

1. âœ… LLM atualizado para reconhecer formato CSN
2. âœ… Filtro de email ajustado para "PROGRAMAÃ‡ÃƒO"
3. â­ï¸ Testar com emails reais
4. â­ï¸ Ajustar geocoding para locais CSN
5. â­ï¸ Validar integraÃ§Ã£o com MinasTaxi API

**O sistema estÃ¡ pronto para processar os emails da CSN MineraÃ§Ã£o!** ğŸš€
